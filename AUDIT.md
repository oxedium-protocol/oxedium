# Oxedium Program ‚Äî Security Audit & Protocol Analysis

**–í–µ—Ä—Å–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã**: Anchor 0.32.1
**Program ID**: `oxe2YhrQZ8yjbaHfp6mQXfSJd124qK2sRpdH9ePZXh1`
**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2026-02-13
**–§–∞–π–ª—ã**: `programs/oxedium-program/src/**`

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã](#1-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–≥—Ä–∞–º–º—ã)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏](#2-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-—É—è–∑–≤–∏–º–æ—Å—Ç–∏)
3. [–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫](#3-–≤—ã—Å–æ–∫–∏–π-—Ä–∏—Å–∫)
4. [–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫](#4-—Å—Ä–µ–¥–Ω–∏–π-—Ä–∏—Å–∫)
5. [–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫](#5-–Ω–∏–∑–∫–∏–π-—Ä–∏—Å–∫)
6. [–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞](#6-–∞–Ω–∞–ª–∏–∑-–ª–æ–≥–∏–∫–∏-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞)
7. [–ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞](#7-–∏—Ç–æ–≥–æ–≤–∞—è-—Ç–∞–±–ª–∏—Ü–∞)

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã

### –°–æ—Å—Ç–∞–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------|-----------|
| Treasury PDA | `states/treasury.rs` | –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: admin, fee_bps, stoptap, deviation |
| Vault PDA | `states/vault.rs` | –ü—É–ª –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ + LP-–º–∏–Ω—Ç + –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π yield |
| Staker PDA | `states/staker.rs` | –ü–æ–∑–∏—Ü–∏—è —Å—Ç–µ–π–∫–µ—Ä–∞: last_cumulative_yield, pending_claim |
| init_treasury | `admin/init_treasury.rs` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Treasury —Å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–º admin |
| update_treasury | `admin/update_treasury.rs` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ admin/fee/stoptap |
| init_vault | `admin/init_vault.rs` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ vault + LP-–º–∏–Ω—Ç–∞ |
| update_vault | `admin/update_vault.rs` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ base_fee, pyth feed |
| collect | `admin/collect.rs` | –í—ã–≤–æ–¥ protocol_yield –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º |
| staking | `staker/staking.rs` | –î–µ–ø–æ–∑–∏—Ç —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí –º–∏–Ω—Ç LP |
| unstaking | `staker/unstaking.rs` | –°–∂–∏–≥–∞–Ω–∏–µ LP ‚Üí –≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–æ–≤ |
| claim | `staker/claim.rs` | –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ yield |
| swap | `trader/swap.rs` | –û–±–º–µ–Ω —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –¥–≤–∞ vault —Å –∫–æ–º–∏—Å—Å–∏–µ–π |

### –ü–æ—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  ‚îÄ‚îÄstake‚îÄ‚îÄ‚ñ∫  treasury_ata  ‚îÄ‚îÄyield‚îÄ‚îÄ‚ñ∫  staker_pda.pending_claim
                                ‚îÇ
                         swap –∫–æ–º–∏—Å—Å–∏—è:
                         lp_fee ‚Üí cumulative_yield_per_lp
                         protocol_fee ‚Üí vault.protocol_yield ‚Üí admin
```

---

## 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### C-1 ‚Äî –ò–ù–í–ï–†–¢–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê –®–¢–†–ê–§–ê –ü–†–ò –ê–ù–°–¢–ï–ô–ö–ò–ù–ì–ï

**–§–∞–π–ª**: [unstaking.rs:28](programs/oxedium-program/src/instructions/staker/unstaking.rs#L28)
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å**: CRITICAL ‚Äî –ø–æ–ª–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å—Ä–µ–¥—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–æ–¥**:
```rust
if extra_fee_bps > 0 {
    unstake_amount -= calculate_fee_amount(unstake_amount, extra_fee_bps, 0)?.0;
    //                                                                         ^^^ –û–®–ò–ë–ö–ê
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**:
`calculate_fee_amount` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ `(amount_after_fee, lp_fee, protocol_fee)`.
–ü–æ–ª–µ `.0` ‚Äî —ç—Ç–æ —Å—É–º–º–∞ **–ø–æ—Å–ª–µ** –≤—ã—á–µ—Ç–∞ –∫–æ–º–∏—Å—Å–∏–∏ (98% –ø—Ä–∏ fee=2%).

–ü—Ä–∏ extra_fee_bps = 200 (2%):
- `amount_after_fee` = 98% –æ—Ç —Å—É–º–º—ã
- `unstake_amount -= 98%` ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç **—Ç–æ–ª—å–∫–æ 2%** —Å–≤–æ–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å 98%, –∞ –Ω–µ 2%.

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥** (–æ–¥–Ω–æ –∏–∑ –¥–≤—É—Ö):
```rust
// –í–∞—Ä–∏–∞–Ω—Ç 1: –ø—Ä–∏—Å–≤–æ–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –∫–æ–º–∏—Å—Å–∏–∏
unstake_amount = calculate_fee_amount(unstake_amount, extra_fee_bps, 0)?.0;

// –í–∞—Ä–∏–∞–Ω—Ç 2: –≤—ã—á–µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–º–∏—Å—Å–∏—é
unstake_amount -= calculate_fee_amount(unstake_amount, extra_fee_bps, 0)?.1;
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: —à—Ç—Ä–∞—Ñ–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (—Ä–∞–∑–Ω–∏—Ü–∞) –Ω–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–∞–∫ yield LP-–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–ª–∏ protocol_fee ‚Äî –æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–∏—Å–∞—é—Ç –≤ treasury –∫–∞–∫ –Ω–µ—É—á—Ç—ë–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å.

---

### C-2 ‚Äî –î–ï–õ–ï–ù–ò–ï –ù–ê –ù–û–õ–¨ –í `fees_setting` (PANIC)

**–§–∞–π–ª**: [fees_setting.rs:24-32](programs/oxedium-program/src/components/fees_setting.rs#L24)
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å**: CRITICAL ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç —Å –ø–∞–Ω–∏–∫–æ–π

**–ö–æ–¥**:
```rust
let delta_in_bps: i128 =
    (vault_in.current_liquidity as i128 - vault_in.initial_liquidity as i128)
        * 10_000
        / vault_in.initial_liquidity as i128;  // ‚Üê –µ—Å–ª–∏ == 0, –ü–ê–ù–ò–ö–ê
```

**–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç**: –µ—Å–ª–∏ —É vault –Ω–µ—Ç —Å—Ç–µ–π–∫–µ—Ä–æ–≤ (`initial_liquidity == 0`). –õ—é–±–æ–π —Å–≤–æ–ø –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø–∞–Ω–∏–∫–æ–π, –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ vault –ø—É—Å—Ç–æ–π.

**–ù–µ—Ç –∑–∞—â–∏—Ç—ã**: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ `if initial_liquidity == 0`.

---

### C-3 ‚Äî –î–ï–õ–ï–ù–ò–ï –ù–ê –ù–û–õ–¨ –í `unstaking` (PANIC)

**–§–∞–π–ª**: [unstaking.rs:19](programs/oxedium-program/src/instructions/staker/unstaking.rs#L19)
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å**: CRITICAL

**–ö–æ–¥**:
```rust
let liquidity_ratio = (vault.current_liquidity as u128 * 100) / vault.initial_liquidity as u128;
```

**–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç**: –µ—Å–ª–∏ `initial_liquidity == 0` ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∞–Ω—Å—Ç–µ–π–∫–∏–Ω–≥–µ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –ø—Ä–∏ –±–∞–≥–µ –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

---

### C-4 ‚Äî –î–ï–õ–ï–ù–ò–ï –ù–ê –ù–û–õ–¨ –í `compute_swap_math` (PANIC)

**–§–∞–π–ª**: [compute_swap_math.rs:33](programs/oxedium-program/src/components/compute_swap_math.rs#L33)
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å**: CRITICAL

**–ö–æ–¥**:
```rust
let percent_of_liquidity = vault_out.current_liquidity / treasury.deviation;
```

**–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç**: admin –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `treasury.deviation = 0` —á–µ—Ä–µ–∑ `update_treasury`. –ü—Ä–∏ —ç—Ç–æ–º –≤—Å–µ —Å–≤–æ–ø—ã —É–ø–∞–¥—É—Ç —Å –ø–∞–Ω–∏–∫–æ–π. –¢–∞–∫–∂–µ –µ—Å–ª–∏ `current_liquidity == 0` –∏ vault —É–∂–µ –æ–ø—É—Å—Ç–µ–ª.

---

### C-5 ‚Äî –ù–ï–ö–û–†–†–ï–ö–¢–ù–´–ô –ó–ù–ê–ú–ï–ù–ê–¢–ï–õ–¨ –ü–†–ò –†–ê–°–ß–Å–¢–ï YIELD PER LP

**–§–∞–π–ª**: [swap.rs:94](programs/oxedium-program/src/instructions/trader/swap.rs#L94)
**–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å**: CRITICAL ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤

**–ö–æ–¥**:
```rust
vault_out.cumulative_yield_per_lp +=
    (result.lp_fee_amount as u128 * SCALE) / vault_out.initial_liquidity as u128;
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –≤ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ —Å—Ç–æ–∏—Ç `initial_liquidity`, –∫–æ—Ç–æ—Ä–∞—è **–º–µ–Ω—è–µ—Ç—Å—è** —Å –∫–∞–∂–¥—ã–º —Å—Ç–µ–π–∫–∏–Ω–≥–æ–º –∏ –∞–Ω—Å—Ç–µ–π–∫–∏–Ω–≥–æ–º (—ç—Ç–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å—á—ë—Ç—á–∏–∫ –∑–∞—Å—Ç–µ–π–∫–∞–Ω–Ω—ã—Ö LP, –∞ –Ω–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞). –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫:

1. **–ó–∞–≤—ã—à–µ–Ω–Ω–æ–º—É yield** –ø—Ä–∏ –º–∞–ª–æ–º `initial_liquidity` ‚Äî –Ω–æ–≤—ã–µ —Å—Ç–µ–π–∫–µ—Ä—ã –ø–æ–ª—É—á–∞—é—Ç —á—É–∂–æ–π –¥–æ—Ö–æ–¥
2. **–î–µ–ª–µ–Ω–∏—é –Ω–∞ –Ω–æ–ª—å** –µ—Å–ª–∏ `initial_liquidity == 0` –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—Å–µ –≤—ã—à–ª–∏ –∏–∑ —Å—Ç–µ–π–∫–∏–Ω–≥–∞
3. –î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É LP –≤ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –≤ –º–æ–º–µ–Ω—Ç —Å–≤–æ–ø–∞

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–≤–µ–Ω —Ç–µ–∫—É—â–µ–º—É supply LP-—Ç–æ–∫–µ–Ω–æ–≤ (`lp_mint.supply`), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –æ—Ç —Å—Ç–µ–π–∫–∞/–∞–Ω—Å—Ç–µ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ.

---

## 3. –í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫

### H-1 ‚Äî FEE √ó 10 –î–ï–õ–ê–ï–¢ –ö–†–£–ü–ù–´–ï –°–í–û–ü–´ –ù–ê–í–°–ï–ì–î–ê –ù–ï–í–û–ó–ú–û–ñ–ù–´–ú–ò

**–§–∞–π–ª**: [compute_swap_math.rs:34-42](programs/oxedium-program/src/components/compute_swap_math.rs#L34)

**–ö–æ–¥**:
```rust
let adjusted_swap_fee_bps = if raw_out > percent_of_liquidity {
    swap_fee_bps * 10   // –ù–∞–ø—Ä–∏–º–µ—Ä: 2000 bps ‚Üí 20_000 bps
};

if adjusted_swap_fee_bps + protocol_fee_bps > 10_000 {
    return Err(OxediumError::FeeExceeds.into());  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞!
}
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ø—Ä–∏ –±–∞–∑–æ–≤–æ–º `swap_fee = 200 bps` (2%) –∏ `swap_fee * 10 = 2000 bps`, –ø–ª—é—Å –ª—é–±–æ–π `protocol_fee_bps`, —Å—É–º–º–∞ > 10_000 –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç. –ù–æ –ø—Ä–∏ `swap_fee = 1000 bps` (10%) –∏ `swap_fee * 10 = 10_000 + protocol_fee` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞ —Å `FeeExceeds`. –ö—Ä—É–ø–Ω—ã–π —Å–≤–æ–ø –Ω–µ–ª—å–∑—è —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø—Ä–∏ –ª—é–±–æ–º `minimum_out`, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å –¥–æ—Ä–æ–∂–µ.

---

### H-2 ‚Äî –ù–ï–ë–ï–ó–û–ü–ê–°–ù–û–ï –ü–†–ò–í–ï–î–ï–ù–ò–ï `i64 as u64` –í –°–û–ë–´–¢–ò–ò SWAP

**–§–∞–π–ª**: [swap.rs:138-139](programs/oxedium-program/src/instructions/trader/swap.rs#L138)

**–ö–æ–¥**:
```rust
price_in: oracle_in.price_message.price as u64 - oracle_in.price_message.conf,
price_out: oracle_out.price_message.price as u64 + oracle_out.price_message.conf,
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `price_message.price` ‚Äî —Ç–∏–ø `i64`. –ü—Ä–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∫ `u64` –ø–æ–ª—É—á–∞–µ—Ç—Å—è –æ–≥—Ä–æ–º–Ω–æ–µ —á–∏—Å–ª–æ –±–µ–∑ –ø–∞–Ω–∏–∫–∏. Pyth –≤—Ä–µ–º–µ–Ω–∞–º–∏ –ø—É–±–ª–∏–∫—É–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ exponent-—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —ç–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏—Ö –∞–∫—Ç–∏–≤–æ–≤. –î–∞–Ω–Ω—ã–µ –≤ —Å–æ–±—ã—Ç–∏–∏ SwapEvent –±—É–¥—É—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏. –•–æ—Ç—è —ç—Ç–æ –Ω–µ –≤–µ–¥—ë—Ç –∫ –ø–æ—Ç–µ—Ä–µ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞–ø—Ä—è–º—É—é, —ç—Ç–æ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä—É–µ—Ç off-chain –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

### H-3 ‚Äî ADMIN –ú–û–ñ–ï–¢ –ó–ê–ú–û–†–û–ó–ò–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –ò –í–´–í–ï–°–¢–ò –°–†–ï–î–°–¢–í–ê

**–§–∞–π–ª—ã**: [collect.rs](programs/oxedium-program/src/instructions/admin/collect.rs), [update_treasury.rs](programs/oxedium-program/src/instructions/admin/update_treasury.rs)

–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:
1. Admin —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `stoptap = true` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç —Å—Ç–µ–π–∫–∞—Ç—å, –∞–Ω—Å—Ç–µ–π–∫–∞—Ç—å, –∫–ª–µ–π–º–∏—Ç—å
2. `collect` **–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç** `stoptap`
3. Admin –≤—ã–≤–æ–¥–∏—Ç –≤–µ—Å—å `protocol_yield`
4. Admin –º–æ–∂–µ—Ç —Ç–∞–∫–∂–µ –≤—ã—Å—Ç–∞–≤–∏—Ç—å `deviation = 0` ‚Üí –≤—Å–µ —Å–≤–æ–ø—ã –ø–∞–¥–∞—é—Ç —Å –ø–∞–Ω–∏–∫–æ–π (C-4)

–≠—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–µ–∫—Ç–æ—Ä rug-pull.

---

## 4. –°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫

### M-1 ‚Äî `println!` –í –ü–†–û–î–ê–ö–®–ù –ö–û–î–ï

**–§–∞–π–ª**: [fees_setting.rs:28,33](programs/oxedium-program/src/components/fees_setting.rs#L28)

```rust
println!("Delta in bps: {}", delta_in_bps);
println!("Delta out bps: {}", delta_out_bps);
```

–ù–∞ Solana –≤—ã–≤–æ–¥ `println!` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ on-chain –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ (–Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ª–æ–≥–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ `msg!`). –≠—Ç–æ –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Å–æ—Ä—è–µ—Ç –±–∏–Ω–∞—Ä–Ω–∏–∫ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø—Ä–æ–≥—Ä–∞–º–º—ã. –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `msg!()`.

---

### M-2 ‚Äî –®–¢–†–ê–§–ù–ê–Ø –ö–û–ú–ò–°–°–ò–Ø –ü–†–ò –ê–ù–°–¢–ï–ô–ö–ò–ù–ì–ï –ù–ï –†–ê–°–ü–†–ï–î–ï–õ–Ø–ï–¢–°–Ø

**–§–∞–π–ª**: [unstaking.rs:65-66](programs/oxedium-program/src/instructions/staker/unstaking.rs#L65)

```rust
vault.initial_liquidity -= amount;       // —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–ª–Ω—ã–π amount
vault.current_liquidity -= unstake_amount; // —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ amount - fee
```

–†–∞–∑–Ω–∏—Ü–∞ (—à—Ç—Ä–∞—Ñ–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è) –æ—Å—Ç–∞—ë—Ç—Å—è –≤ `treasury_ata` –∫–∞–∫ –Ω–µ—É—á—Ç—ë–Ω–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `protocol_yield`, –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `cumulative_yield_per_lp`. –î–µ–Ω—å–≥–∏ "–∑–∞–≤–∏—Å–∞—é—Ç".

---

### M-3 ‚Äî `initial_liquidity` ‚Äî –û–®–ò–ë–û–ß–ù–ê–Ø –°–ï–ú–ê–ù–¢–ò–ö–ê –ü–ï–†–ï–ú–ï–ù–ù–û–ô

**–§–∞–π–ª—ã**: staking.rs, unstaking.rs, swap.rs

`initial_liquidity` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ **–¥–≤—É—Ö –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö** —Ä–æ–ª—è—Ö:
1. –¢–µ–∫—É—â–∏–π —Å—É–º–º–∞—Ä–Ω—ã–π –æ–±—ä—ë–º —Å—Ç–µ–π–∫–∏–Ω–≥–∞ (–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º stake/unstake)
2. –ë–∞–∑–æ–≤–∞—è –≤–µ–ª–∏—á–∏–Ω–∞ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ yield-per-LP (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–π –∏–ª–∏ —Ä–∞–≤–Ω–∞ LP supply)

–ò–º—è –≤–≤–æ–¥–∏—Ç –≤ –∑–∞–±–ª—É–∂–¥–µ–Ω–∏–µ. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è yield-—Ä–∞—Å—á—ë—Ç–æ–≤ ‚Äî `lp_mint.supply`.

---

### M-4 ‚Äî –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ü–†–û–í–ï–†–ö–ê `amount == 0`

**–§–∞–π–ª—ã**: staking.rs, unstaking.rs, swap.rs

–ù–∏–∫—Ç–æ –Ω–µ –º–µ—à–∞–µ—Ç –≤—ã–∑–≤–∞—Ç—å `staking(0)` –∏–ª–∏ `unstaking(0)`. –≠—Ç–æ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ—Ç–µ—Ä–µ —Å—Ä–µ–¥—Å—Ç–≤, –Ω–æ:
- –û–±–Ω–æ–≤–ª—è–µ—Ç `staker.last_cumulative_yield` –±–µ–∑ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è yield (–º–æ–∂–µ—Ç "—Å—ä–µ—Å—Ç—å" –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π yield, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π > –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è —Å –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

---

### M-5 ‚Äî –ü–ï–†–ï–ü–û–õ–ù–ï–ù–ò–ï –í `calculate_staker_yield` –í–û–ó–í–†–ê–©–ê–ï–¢ 0

**–§–∞–π–ª**: [calculate_staker_yield.rs:25-26](programs/oxedium-program/src/components/calculate_staker_yield.rs#L25)

```rust
let total_yield = delta_yield_per_lp
    .checked_mul(staker_balance as u128)
    .unwrap_or(0);  // ‚Üê –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ yield = 0, –Ω–µ –æ—à–∏–±–∫–∞
```

–ï—Å–ª–∏ —É–º–Ω–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è (–±–æ–ª—å—à–æ–π –±–∞–ª–∞–Ω—Å √ó –±–æ–ª—å—à–æ–π delta), –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 0. –°—Ç–µ–π–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–µ—Ç –≤–µ—Å—å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π yield –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π.

---

### M-6 ‚Äî –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –î–û–°–¢–ê–¢–û–ß–ù–û–°–¢–ò –õ–ò–ö–í–ò–î–ù–û–°–¢–ò

**–§–∞–π–ª**: [compute_swap_math.rs:47](programs/oxedium-program/src/components/compute_swap_math.rs#L47)

```rust
if vault_out.current_liquidity < (after_fee + lp_fee + protocol_fee) {
    return Err(OxediumError::InsufficientLiquidity.into());
}
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `raw_out` (= `after_fee + lp_fee + protocol_fee`), –Ω–æ –∏–∑ vault —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ `net_amount_out` (= `after_fee`). –ö–æ–º–∏—Å—Å–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ vault. –≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞, –Ω–æ –ª–æ–≥–∏–∫–∞ –∑–∞–ø—É—Ç–∞–Ω–∞: liquidity check –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–≤–æ–ø —Ä–∞–Ω—å—à–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ.

---

## 5. –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫

### L-1 ‚Äî –ó–ê–•–ê–†–î–ö–û–ñ–ï–ù–ù–´–ô ADMIN KEY

**–§–∞–π–ª**: [init_treasury.rs:14](programs/oxedium-program/src/instructions/admin/init_treasury.rs#L14)

```rust
let admin_key = Pubkey::from_str("3gXnk9LTHHtFzKK5pkKzp58okeo9V72MjGSyzFUCvKk2")
    .map_err(|_| OxediumError::InvalidAdmin)?;
```

–ï—Å–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –±—É–¥–µ—Ç —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É—Ç–µ—Ä—è–Ω, Treasury –Ω–µ–ª—å–∑—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å admin —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –æ–≥—Ä–∞–Ω–∏—á–∏–≤ –µ–≥–æ –¥–µ–ø–ª–æ–π–µ—Ä–æ–º.

---

### L-2 ‚Äî –ò–ó–õ–ò–®–ù–ï–ï –ö–õ–û–ù–ò–†–û–í–ê–ù–ò–ï –ê–ö–ö–ê–£–ù–¢–ê

**–§–∞–π–ª**: [update_vault.rs:8](programs/oxedium-program/src/instructions/admin/update_vault.rs#L8)

```rust
let treasury: Account<'_, Treasury> = ctx.accounts.treasury_pda.clone();
```

–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã. –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –ø–∞–º—è—Ç–∏/–≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

---

### L-3 ‚Äî –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ü–†–û–í–ï–†–ö–ê `initial_liquidity` –î–û –î–ï–õ–ï–ù–ò–Ø

–í –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ `initial_liquidity` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ `require!(vault.initial_liquidity > 0, ...)`. –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω—ã–µ guard-—É—Å–ª–æ–≤–∏—è.

---

### L-4 ‚Äî EXPONENT –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢–°–Ø –¢–û–õ–¨–ö–û –ö–ê–ö –ê–ë–°–û–õ–Æ–¢–ù–û–ï –ó–ù–ê–ß–ï–ù–ò–ï

**–§–∞–π–ª**: [raw_amount_out.rs:24-25](programs/oxedium-program/src/components/raw_amount_out.rs#L24)

```rust
let exp_in = price_message_in.exponent.abs() as u32;
```

Pyth exponent –≤—Å–µ–≥–¥–∞ ‚â§ 0 (–æ–±—ã—á–Ω–æ -8), –ø–æ—ç—Ç–æ–º—É `.abs()` –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω. –û–¥–Ω–∞–∫–æ —è–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `assert!(exp <= 0)` —Å–¥–µ–ª–∞–ª–∞ –±—ã –∫–æ–¥ –Ω–∞–¥—ë–∂–Ω–µ–µ.

---

## 6. –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–∏–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª

Oxedium ‚Äî —ç—Ç–æ DEX —Å –µ–¥–∏–Ω—ã–º –ø—É–ª–æ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω (vault-based AMM). –¶–µ–Ω—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ –æ—Ä–∞–∫—É–ª–∞ Pyth, –∞ –Ω–µ –∏–∑ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–æ–≤ (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç Uniswap xy=k). LP-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –Ω–∞ swap-–∫–æ–º–∏—Å—Å–∏—è—Ö.

### –ú–µ—Ö–∞–Ω–∏–∫–∞ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏

```
–î–æ—Ö–æ–¥ LP = Œ£ (swap_fee_bps √ó raw_amount_out) / initial_liquidity √ó LP_–±–∞–ª–∞–Ω—Å_—Å—Ç–µ–π–∫–µ—Ä–∞
```

LP-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç **—Ç–æ–ª—å–∫–æ** –æ—Ç –æ–±—ä—ë–º–∞ —Å–≤–æ–ø–æ–≤. –ù–µ—Ç —ç–º–∏—Å—Å–∏–∏ —Ç–æ–∫–µ–Ω–∞, –Ω–µ—Ç –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–π, –Ω–µ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Ö–æ–¥–∞.

### –ë—É–¥–µ—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å?

#### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

- **Adversarial pricing**: –ø—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É —Ü–µ–Ω—ã –≤—Ö–æ–¥—è—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ –≤–µ—Ä—Ö–Ω—é—é –¥–ª—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ. –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç LP –æ—Ç oracle manipulation ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –∑—Ä–µ–ª—ã–π –ø–æ–¥—Ö–æ–¥.
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è (quadratic curve)**: –ø—Ä–∏ –¥–∏—Å–±–∞–ª–∞–Ω—Å–µ vault'–æ–≤ –∫–æ–º–∏—Å—Å–∏—è —Ä–∞—Å—Ç—ë—Ç –ø–æ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–π –∫—Ä–∏–≤–æ–π. –≠—Ç–æ incentivize rebalancing –∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –Ω–∞–ø–∞–¥–µ–Ω–∏–π –Ω–∞ depleted vaults.
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –∫—Ä—É–ø–Ω—ã—Ö —Å–≤–æ–ø–æ–≤ (x10 fee)**: —Å–≤–æ–ø, "—Å—ä–µ–¥–∞—é—â–∏–π" >10% –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤ 10 —Ä–∞–∑ –¥–æ—Ä–æ–∂–µ ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞—â–∏—Ç—ã –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π.
- **Staleness check**: —Ü–µ–Ω—ã –∏–∑ Pyth –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å–≤–µ–∂–µ—Å—Ç—å —á–µ—Ä–µ–∑ `max_age_price`.
- **Emergency stop (stoptap)**: –º–µ—Ö–∞–Ω–∏–∑–º –ø–∞—É–∑—ã –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏.
- **Checked arithmetic**: –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç `checked_*`, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç silent overflow.

#### ‚ùå –ß—Ç–æ –º–µ—à–∞–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª—É —Ä–∞–±–æ—Ç–∞—Ç—å

**1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ –∞–Ω—Å—Ç–µ–π–∫–∏–Ω–≥–∞ (C-1)**
–ü—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∏–∂–µ 50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ—Ç–µ—Ä—è—é—Ç –ø–æ—á—Ç–∏ –≤—Å–µ —Å–≤–æ–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ (–ø–æ–ª—É—á–∞—Ç 2% –≤–º–µ—Å—Ç–æ 98%). –≠—Ç–æ —Ä–∞–∑—Ä—É—à–∏—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –ø—Ä–æ—Ç–æ–∫–æ–ª—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∂–µ –ø–µ—Ä–∏–æ–¥–µ –Ω–∏–∑–∫–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

**2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç yield (C-5)**
–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É LP supply. –ü—Ä–∏ —á–∞—Å—Ç—ã—Ö stake/unstake –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç "yield dilution" –∏–ª–∏ "yield amplification", —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–∞ –º–µ–∂–¥—É LP.

**3. –ü–∞–Ω–∏–∫–∞ –ø—Ä–∏ –ø—É—Å—Ç–æ–º vault (C-2, C-3, C-4)**
–ü—Ä–∏ –Ω—É–ª–µ–≤–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–º vault –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ–π. –í–µ–∫—Ç–æ—Ä DoS: –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –¥–æ –Ω—É–ª—è.

**4. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫—Ä—É–ø–Ω—ã—Ö —Å–≤–æ–ø–æ–≤ (H-1)**
–ü—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö `base_fee` –≤—Å–µ —Å–≤–æ–ø—ã, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–µ –ø–æ—Ä–æ–≥ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏, –±—É–¥—É—Ç –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –≠—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–±—ä—ë–º —Ç–æ—Ä–≥–æ–≤ –∏ —Å–Ω–∏–∂–∞–µ—Ç –¥–æ—Ö–æ–¥ LP.

#### –ü—Ä–∏–Ω–µ—Å—ë—Ç –ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–æ—Ö–æ–¥?

**–ü—Ä–∏ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∫–æ–¥–∞ ‚Äî –Ω–µ—Ç.**

| –°—Ü–µ–Ω–∞—Ä–∏–π | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|---------|-----------|
| –ü–µ—Ä–∏–æ–¥ –Ω–∏–∑–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ (<50% –æ—Ç –ø–∏–∫–∞) | LP –ø–æ—Ç–µ—Ä—è—é—Ç 98% –ø—Ä–∏ –≤—ã–≤–æ–¥–µ (C-1) |
| –í—Å–µ LP –≤—ã—Ö–æ–¥—è—Ç –∏–∑ —Å—Ç–µ–π–∫–∏–Ω–≥–∞ | –í—Å–µ —Å–≤–æ–ø—ã –ø–∞–¥–∞—é—Ç —Å –ø–∞–Ω–∏–∫–æ–π (C-2, C-5) |
| –ö—Ä—É–ø–Ω—ã–π —Ç—Ä–µ–π–¥–µ—Ä | –°–≤–æ–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Å FeeExceeds (H-1) |
| Admin —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç deviation=0 | –í—Å–µ —Å–≤–æ–ø—ã –ø–∞–¥–∞—é—Ç (C-4) |

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤** ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª –∏–º–µ–µ—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª:

- –ú–æ–¥–µ–ª—å vault-based AMM —Å oracle-—Ü–µ–Ω–∞–º–∏ –ª–∏—à–µ–Ω–∞ impermanent loss (IL), —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º
- Quadratic dynamic fee ‚Äî –∑—Ä–µ–ª—ã–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º
- Adversarial pricing –Ω–∞–¥—ë–∂–Ω–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—Ä–∞–∫—É–ª—å–Ω—ã—Ö –∞—Ç–∞–∫
- –û–¥–Ω–∞–∫–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è —Å Orca, Raydium, Jupiter –≤—ã—Å–æ–∫–∞ ‚Äî –Ω—É–∂–Ω–æ –Ω–∏—à–µ–≤–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## 7. –ò—Ç–æ–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞

| ID | –°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å | –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|------------|------|----------|
| C-1 | üî¥ CRITICAL | unstaking.rs:28 | –ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —à—Ç—Ä–∞—Ñ–∞ ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 2% –≤–º–µ—Å—Ç–æ 98% |
| C-2 | üî¥ CRITICAL | fees_setting.rs:27,32 | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ initial_liquidity == 0 |
| C-3 | üî¥ CRITICAL | unstaking.rs:19 | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ initial_liquidity == 0 |
| C-4 | üî¥ CRITICAL | compute_swap_math.rs:33 | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –ø—Ä–∏ deviation == 0 |
| C-5 | üî¥ CRITICAL | swap.rs:94 | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –≤ yield/LP —Ä–∞—Å—á—ë—Ç–µ |
| H-1 | üü† HIGH | compute_swap_math.rs:34 | x10 fee –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å–≤–æ–ø—ã –≤–º–µ—Å—Ç–æ —É–¥–æ—Ä–æ–∂–∞–Ω–∏—è |
| H-2 | üü† HIGH | swap.rs:138-139 | –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π cast i64‚Üíu64 –¥–ª—è —Ü–µ–Ω—ã –≤ —Å–æ–±—ã—Ç–∏–∏ |
| H-3 | üü† HIGH | collect.rs, update_treasury.rs | Admin rug-pull –≤–µ–∫—Ç–æ—Ä —á–µ—Ä–µ–∑ stoptap + collect |
| M-1 | üü° MEDIUM | fees_setting.rs:28,33 | println! –≤ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–¥–µ (–º—ë—Ä—Ç–≤—ã–π –∫–æ–¥) |
| M-2 | üü° MEDIUM | unstaking.rs:65-66 | –®—Ç—Ä–∞—Ñ–Ω–∞—è –∫–æ–º–∏—Å—Å–∏—è –Ω–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è |
| M-3 | üü° MEDIUM | staking/unstaking/swap | –°–µ–º–∞–Ω—Ç–∏–∫–∞ initial_liquidity –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ |
| M-4 | üü° MEDIUM | staking/unstaking/swap | –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ amount == 0 |
| M-5 | üü° MEDIUM | calculate_staker_yield.rs:25 | –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0, –Ω–µ –æ—à–∏–±–∫—É |
| M-6 | üü° MEDIUM | compute_swap_math.rs:47 | –ó–∞–ø—É—Ç–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ |
| L-1 | üü¢ LOW | init_treasury.rs:14 | –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–π admin key |
| L-2 | üü¢ LOW | update_vault.rs:8 | –ò–∑–ª–∏—à–Ω–µ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ |
| L-3 | üü¢ LOW | –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ | –ù–µ—Ç —è–≤–Ω—ã—Ö guard-—É—Å–ª–æ–≤–∏–π –ø–µ—Ä–µ–¥ –¥–µ–ª–µ–Ω–∏–µ–º |
| L-4 | üü¢ LOW | raw_amount_out.rs:24 | –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–Ω–∞–∫–∞ exponent |

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **C-1** ‚Äî –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ, –∫–æ–¥ –≤—ã–∑–æ–≤–µ—Ç –ø–æ—Ç–µ—Ä—é —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏
2. **C-5** ‚Äî –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º yield, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lp_mint.supply` –∫–∞–∫ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å
3. **C-2, C-3, C-4** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `require!(x > 0, ...)` –ø–µ—Ä–µ–¥ –≤—Å–µ–º–∏ –¥–µ–ª–µ–Ω–∏—è–º–∏
4. **H-1** ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å `adjusted_swap_fee_bps` –¥–æ `10_000 - protocol_fee_bps` –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏
5. **H-3** ‚Äî —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å timelock –∏–ª–∏ multisig –¥–ª—è admin-–æ–ø–µ—Ä–∞—Ü–∏–π
